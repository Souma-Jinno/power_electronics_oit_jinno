# MOSFET を用いたオペアンプリニアレギュレータ

## 概要

パワーMOSFET（nMOS）を用いた大電流対応リニアレギュレータのシミュレーションです。BJTの代わりにMOSFETを使用することで、より大きな負荷電流に対応し、ゲート駆動電流がほぼゼロという利点を活用します。

## 回路構成

### 主要素子
- **電源電圧**: V4 = 10 V
- **基準電圧**: V3 = PULSE(0, 5, 0.2m, 10n, 10n, 10m)
- **オペアンプ電源**: V5 = +15 V、V6 = -15 V（両電源）
- **オペアンプ**: U2 (UniversalOpamp2)
- **パワーMOSFET**: M2 (RTQ020N05, nチャネル)
- **フィードバック抵抗**: R3 = 6 kΩ、R4 = 12 kΩ
- **負荷抵抗**: R2 = {R} Ω（パラメータスイープ）

### 回路の特徴
- nチャネルMOSFETによる電力制御
- オペアンプの両電源動作（±15 V）
- より大きな負荷電流に対応可能

## 動作原理

### MOSFETの基本動作

1. **ゲート電圧制御**
   - オペアンプ出力がMOSFETのゲートを駆動
   - ゲート-ソース間電圧 V_GS により電流を制御

2. **電圧降下**
   - V_out = V_in - V_DS
   - V_DS：ドレイン-ソース間電圧

3. **ゲート駆動電流**
   - I_G ≈ 0 A（ゲート絶縁構造）
   - オペアンプへの負荷が非常に小さい

### BJTとMOSFETの比較

| 項目 | BJT (2N2222) | MOSFET (RTQ020N05) |
|------|-------------|-------------------|
| 制御端子 | ベース | ゲート |
| 駆動電流 | I_B = I_C / h_FE ≈ mA | I_G ≈ 0 A |
| 最大電流 | ~800 mA | 数 A ~ 数十 A |
| 電圧降下 | V_CE(sat) ≈ 0.2 V | V_DS(on) ≈ 数十 mΩ × I_D |
| 駆動回路 | 電流駆動 | 電圧駆動 |
| スイッチング速度 | 速い | 非常に速い |

### RTQ020N05の主な仕様
- **V_DSS**: 50 V（最大ドレイン-ソース間電圧）
- **I_D**: 20 A（連続ドレイン電流）
- **R_DS(on)**: 約 20 mΩ（@V_GS = 10 V）
- **V_GS(th)**: 1.0 ~ 2.5 V（しきい値電圧）

## フィードバック制御

### 出力電圧の設定

BJTを用いた回路と同じフィードバック制御：
```
V_out = V_ref × (R3 + R4) / R4
      = 5 × (6000 + 12000) / 12000
      = 5 × 1.5
      = 7.5 V
```

### オペアンプの両電源動作

- **正電源**: V5 = +15 V
- **負電源**: V6 = -15 V
- **利点**: 出力電圧範囲が広い（約 -13 V ~ +13 V）

BJTを駆動する場合は単電源でも十分でしたが、MOSFETのゲート駆動には高い電圧が必要な場合があるため、両電源を使用しています。

## シミュレーション設定

### 過渡解析
```
.tran 1m
```
- 解析時間：1 ms

### パラメータスイープ
```
.step param R list 10 50 100
```
- 負荷抵抗 R を 10Ω、50Ω、100Ω と変化させる

### 基準電圧のパルス入力
```
V3: PULSE(0 5 0.2m 10n 10n 10m)
```
- 0.2 ms 後に起動
- 過渡応答を観察

## 理論計算

### R = 10Ω の場合

**出力電圧**:
```
V_out = V_ref × (R3 + R4) / R4 = 7.5 V
```

**負荷電流**:
```
I_out = V_out / R = 7.5 / 10 = 0.75 A
```

**ドレイン電流**:
```
I_D = I_out = 0.75 A
```

**ドレイン-ソース間電圧降下**（R_DS(on) = 20 mΩ と仮定）:
```
V_DS(on) = R_DS(on) × I_D = 0.02 × 0.75 = 0.015 V
```

非常に小さい電圧降下です！

**ゲート駆動電流**:
```
I_G ≈ 0 A（定常状態）
```

**効率**:
```
η = V_out / V_in = 7.5 / 10 = 0.75 = 75%
```

MOSFETの電圧降下が小さいため、BJTよりも高効率です。

## 観察項目

### 確認すべき波形
1. **V(n006)**: 基準電圧（パルス入力）
2. **V(n008)**: 出力電圧
3. **V(n010)**: フィードバック電圧
4. **V(n007)**: オペアンプ出力（ゲート電圧）
5. **I(R2)**: 負荷電流
6. **ID(M2)**: ドレイン電流
7. **IG(M2)**: ゲート電流（ほぼゼロ）

### 負荷変動時の観察
- R = 10Ω、50Ω、100Ω での出力電圧の安定性
- 各負荷条件でのゲート電圧の変化
- ドレイン電流の変化

### BJTとの比較ポイント
1. **ゲート電流 vs ベース電流**
   - MOSFET: I_G ≈ 0 A
   - BJT: I_B = 数 mA

2. **電圧降下**
   - MOSFET: V_DS(on) ≈ 数十 mV
   - BJT: V_CE(sat) ≈ 0.2 ~ 0.7 V

3. **過渡応答**
   - MOSFETの方が高速な応答が期待できる

## 実験課題

### 基礎課題
1. 各負荷抵抗値での出力電圧を測定し、理論値と比較せよ
2. ゲート電流がほぼゼロであることを確認せよ
3. ドレイン-ソース間電圧降下を測定せよ

### 発展課題
1. BJTを用いた回路（seriese_regurator_opamp）と比較せよ
   - 出力電圧の精度
   - 過渡応答時間
   - 駆動電流（ベース電流 vs ゲート電流）

2. 負荷レギュレーションを評価せよ
   - 負荷電流を 0.1 A ~ 1.5 A の範囲で変化させる
   - 出力電圧の変動を測定

3. 最大負荷電流を調べよ
   - MOSFETの許容電流範囲内で最大負荷を求める
   - V_DS の電圧降下を考慮

4. 効率を計算し、BJT回路と比較せよ
   ```
   η = (V_out × I_out) / (V_in × I_D)
   ```

## この回路の利点

### BJT回路からの改善
1. **大電流対応**
   - RTQ020N05: 最大 20 A
   - 2N2222: 最大 800 mA
   - 約 25 倍の電流容量

2. **ゲート駆動電流ゼロ**
   - オペアンプへの負荷が非常に小さい
   - 高効率な駆動回路

3. **低いオン抵抗**
   - R_DS(on) ≈ 20 mΩ
   - 電力損失が小さい
   - 放熱設計が容易

4. **高速スイッチング**
   - 過渡応答が速い
   - 負荷変動への追従性が良い

## この回路の考慮点

### MOSFETの選定
1. **耐圧**: V_DSS > V_in（十分な余裕を持つ）
2. **電流容量**: I_D(max) > 負荷電流の最大値
3. **オン抵抗**: R_DS(on) が小さいほど良い
4. **しきい値電圧**: V_GS(th) < オペアンプ出力範囲

### ゲート駆動電圧
- nチャネルMOSFETは正の V_GS で動作
- オペアンプの出力範囲が十分であることを確認
- 必要に応じてレベルシフト回路を追加

### 過渡特性
- MOSFETのゲート容量により応答速度が決まる
- 安定性を確保するため、補償回路が必要な場合がある

## 応用例

### 実用的なリニアレギュレータ
1. **可変出力電圧電源**
   - フィードバック抵抗を可変にする
   - 0 ~ V_in の範囲で調整可能

2. **電流制限機能**
   - 電流センス抵抗を追加
   - 過電流保護回路を実装

3. **熱保護機能**
   - 温度センサを追加
   - 過熱時に出力を制限

4. **並列接続による大電流化**
   - 複数のMOSFETを並列接続
   - 数十 A の負荷に対応

## まとめ

このMOSFETを用いたリニアレギュレータは：
- **高精度な電圧制御**（オペアンプによるフィードバック）
- **大電流対応**（パワーMOSFETの使用）
- **高効率**（低いオン抵抗）
- **ゲート駆動電流ゼロ**（MOSFET の利点）

を実現しており、実用的な電源回路の基本となる構成です。

## 参考：MOSFETの動作領域

### 線形領域（オーム領域）
- V_DS が小さい領域
- R_DS(on) × I_D として動作
- リニアレギュレータではこの領域を使用

### 飽和領域（アクティブ領域）
- V_DS が大きい領域
- I_D = K × (V_GS - V_th)²
- 電流源として動作

### カットオフ領域
- V_GS < V_th
- I_D ≈ 0 A
- スイッチOFF状態
