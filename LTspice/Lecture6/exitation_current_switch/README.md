# スイッチング動作時の励磁電流

変圧器にスイッチング電圧を印加した際の励磁電流の挙動を観察するシミュレーションです。

## 学習目標

- スイッチング時の励磁電流の波形を理解する
- 励磁電流と負荷電流の重ね合わせを観察する
- 変圧器の過渡応答（オーバーシュート、リンギング）を確認する
- スイッチON/OFF時のエネルギーの流れを理解する

## 回路構成

### 回路パラメータ

| 素子 | 記号 | 値 |
|------|------|-----|
| 入力電圧 | V1 | 10 V (DC) |
| **1次側インダクタンス** | **L1** | **1 mH** |
| **2次側インダクタンス** | **L2** | **1 mH** |
| 結合係数 | K1 | 1.0（理想変圧器） |
| 負荷抵抗 | R1 | 500 Ω |
| スイッチング信号 | V2 | PULSE(-0.01 10 100n 10n 10n 1u 10u) |

### スイッチングパラメータ

- **パルス波形**: -0.01V → 10V
- **遅延時間**: 100 ns
- **立ち上がり時間**: 10 ns
- **立ち下がり時間**: 10 ns
- **パルス幅**: 1 μs
- **周期**: 10 μs（周波数 100 kHz）

## 理論解析

### 励磁電流の計算

スイッチON時、1次側インダクタに電圧が印加されると、励磁電流$I_m$が流れます：

```
v1(t) = L1 × dI_m/dt
```

ON期間（1 μs）での電流増加：

```
ΔI_m = (V1 × ton) / L1
     = (10 V × 1 μs) / 1 mH
     = 10 mA
```

### 負荷電流の計算

2次側に誘導される電圧（巻数比1:1の場合）：

```
V2 = V1 = 10 V
```

2次側負荷電流：

```
I2 = V2 / R1
   = 10 V / 500 Ω
   = 20 mA
```

### 1次側電流の構成

1次側電流$I_1$は、励磁電流$I_m$と負荷電流$I_\ell$の和：

```
I1 = I_m + I_ℓ
```

巻数比が1:1の場合：

```
I_ℓ = I2 = 20 mA
```

したがって、ON時のピーク電流：

```
I1(peak) = I_m + I_ℓ
         ≈ 10 mA + 20 mA
         = 30 mA
```

## シミュレーション設定

```spice
.model SW SW(Ron=1m Roff=1G Vt=0.01)
.tran 10m 10m 9.97m 0.1u
K1 L1 L2 1
```

### シミュレーションパラメータ

- **シミュレーション時間**: 10 ms
- **表示範囲**: 9.97 ms ～ 10 ms（定常状態）
- **最大タイムステップ**: 0.1 μs
- **スイッチモデル**: Ron = 1 mΩ、Roff = 1 GΩ

## 観察項目

### 1. 1次側電流 I(L1)

**期待される波形:**
- **ON時**: 電流が直線的に増加（励磁電流成分）+ 一定値（負荷電流成分）
- **OFF時**: 急激な変化（スイッチング過渡現象）
- **複合波形**: 三角波（励磁）+ 矩形波（負荷）

**ポイント:**
- 励磁電流は変圧器の磁化に必要
- 負荷電流は2次側負荷に対応

### 2. 2次側電流 I(L2)

**期待される波形:**
- **ON時**: 負荷電流が流れる（約20 mA）
- **OFF時**: 0に近い値
- **矩形波状**: スイッチングに同期

**ポイント:**
- 2次側電流は負荷抵抗で決まる
- ON時のみ電流が流れる

### 3. 2次側電圧 V(L2端子)

**期待される波形:**
- **ON時**: 約10 V（1次側と同じ、巻数比1:1）
- **OFF時**: 0 V付近
- **過渡応答**: スイッチング時にオーバーシュート/リンギング

**重要な観察:**
- スイッチOFF時に高電圧スパイクが発生する可能性
- 実際の回路では保護回路が必要

### 4. スイッチ電圧 Vsw

**期待される波形:**
- **ON時**: 10 V（ハイレベル）
- **OFF時**: -0.01 V（ローレベル）
- **矩形波**: 100 kHz

## 実験課題

### 課題1: 励磁電流の確認

1次側電流波形から、励磁電流成分を抽出せよ：
- ON時の電流の傾き（dI/dt）を測定
- 理論値 dI/dt = V/L = 10V/1mH = 10 A/s と比較

### 課題2: 負荷電流の影響

負荷抵抗R1を変化させて、1次側電流の変化を観察せよ：
- R1 = 100 Ω, 500 Ω, 1000 Ω
- 各条件での2次側電流と1次側電流を比較

### 課題3: スイッチング周波数の影響

スイッチング周波数を変化させて、励磁電流のピーク値を観察せよ：
- 周期を 5 μs, 10 μs, 20 μs に変更
- 周波数が高いほど励磁電流が小さくなることを確認

### 課題4: 過渡応答の観察

シミュレーション時間範囲を変更して、起動時の過渡応答を観察せよ：
- `.tran 10m` に変更（0 ms から表示）
- 起動時の電流波形を確認
- 定常状態に達するまでの時間を測定

## 発展課題

### 1. 巻数比の影響

巻数比を変更してシミュレーションせよ（L2の値を変更）：
- L2 = 0.5 mH（巻数比 1:0.707）
- L2 = 2 mH（巻数比 1:1.414）
- 2次側電圧と電流の変化を確認

### 2. 結合係数の影響

結合係数Kを1.0から小さくして、漏れインダクタンスの影響を観察せよ：
- K = 0.95, 0.9, 0.8
- 漏れインダクタンスによるスパイク電圧の発生を確認

### 3. デューティ比の変更

パルス幅を変更してデューティ比を変えた場合の影響を観察せよ：
- パルス幅: 0.5 μs (D=0.05), 2 μs (D=0.2), 5 μs (D=0.5)
- 励磁電流のピーク値の変化を確認

## スイッチング時のエネルギーの流れ

### ON時

```
入力電源 → 1次側インダクタ → 磁束 → 2次側 → 負荷
         ↓
      励磁電流（磁気エネルギー蓄積）
```

### OFF時

```
1次側: 磁気エネルギーの放出 → 電圧スパイク
2次側: 電流が停止
```

## 注意事項

- スイッチOFF時に高電圧スパイクが発生する
- 実際の回路では、スナバ回路やクランプ回路が必要
- 励磁電流が0になる前にスイッチをONにすると、電流が累積する
- 変圧器の磁気飽和に注意（実際のコアでは飽和あり）

## 教科書との対応

- **第6章 スライド30-31**: スイッチング時の波形
- **式(1)**: V = L(dI/dt)
- **式(I₁ = I_m + I_ℓ)**: 1次側電流の構成

## 関連ファイル

- フォワードコンバータ: [../foward_converter/](../foward_converter/)
- フライバック（降圧）: [../flyback_converter_back/](../flyback_converter_back/)
- フライバック（昇圧）: [../flyback_converter_boost/](../flyback_converter_boost/)

---

[← Lecture6トップに戻る](../)
