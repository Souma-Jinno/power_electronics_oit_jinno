# Lecture 6: 絶縁型DC-DCコンバータのLTspiceシミュレーション

第6回講義「直流-直流変換（２）」で使用するLTspiceシミュレーションファイルです。

## 概要

本フォルダには、変圧器を用いた絶縁型DC-DCコンバータのシミュレーションファイルが含まれています。フォワードコンバータ（絶縁型降圧）とフライバックコンバータ（絶縁型昇降圧）の動作原理を理解するために、定常状態における電圧・電流波形を観察できます。

## フォルダ構成

### 1. 励磁電流とスイッチング

#### `exitation_current_switch/` - スイッチング時の励磁電流

変圧器にスイッチング電圧を印加した際の励磁電流と負荷電流の挙動を観察します。

**回路パラメータ：**
- 入力電圧: V1 = 10V (DC)
- 変圧器: L1 = L2 = 1mH、結合係数 K = 1.0
- 負荷抵抗: R1 = 500Ω
- スイッチング: PULSE(-0.01 10 100n 10n 10n 1u 10u)
- 周波数: 100 kHz

**ファイル：**
- `exitation_current_switch.asc` - LTspiceシミュレーション回路図

**シミュレーション設定：**
```
.tran 10m 10m 9.97m 0.1u
.model SW SW(Ron=1m Roff=1G Vt=0.01)
K1 L1 L2 1
```

**観察項目：**
- 1次側電流: 励磁電流$I_m$ + 負荷電流$I_\ell$の重ね合わせ
- 2次側電流: 負荷電流（ON時のみ）
- 過渡応答: スイッチング時のオーバーシュート/リンギング
- 電流の構成: $I_1 = I_m + I_\ell$

**詳細**: [exitation_current_switch/README.md](exitation_current_switch/README.md)

---

### 2. フォワードコンバータ（絶縁型降圧）

#### `foward_converter/` - フォワードコンバータ

絶縁型降圧DC-DCコンバータです。ON時に1次側から2次側へエネルギーを転送します。

**回路パラメータ：**
- 入力電圧: V1 = 100V
- 変圧器: L1 = L3 = 10mH（1次側）、L2 = 0.1mH（2次側）
- リセット巻線: L3 = 10mH（励磁電流リセット用）
- 出力インダクタ: L4 = 1.0mH
- 出力コンデンサ: C1 = 500μF
- 負荷抵抗: R2 = 5Ω
- デューティ比: D = 0.3
- スイッチング周波数: fsw = 20kHz
- 理論出力電圧: Vout ≈ 3V

**ファイル：**
- `foward_converter.asc` - LTspiceシミュレーション回路図

**シミュレーション設定：**
```
.tran 51m 51m 50.85m 0.1u
.param fsw=20k
.param Tsw=1/{fsw}
.param D=0.3
K1 L1 L3 L2 1
```

**観察項目：**
- 出力電圧: 約3V（降圧動作）
- リセット巻線の動作: OFF時の励磁電流経路
- ON時のエネルギー転送: 1次側→2次側
- 出力インダクタ電流: 連続モード（CCM）

**詳細**: [foward_converter/README.md](foward_converter/README.md)

---

### 3. フライバックコンバータ（絶縁型昇降圧）

#### `flyback_converter_back/` - フライバックコンバータ（降圧動作）

絶縁型昇降圧コンバータの降圧動作（D < 0.5）です。

**回路パラメータ：**
- 入力電圧: V1 = 12V
- 変圧器: L1 = L2 = 0.7mH、結合係数 K = 1.0
- 出力コンデンサ: C1 = 500μF
- 負荷抵抗: R2 = 5Ω
- デューティ比: D = 0.2941（< 0.5）
- スイッチング周波数: fsw = 20kHz
- 理論出力電圧: Vout = D/(1-D) × Vin ≈ 5V

**ファイル：**
- `flyback_converter_back.asc` - LTspiceシミュレーション回路図

**シミュレーション設定：**
```
.tran 500m 500m 499.83m 0.2u
.param fsw=20k
.param Tsw=1/{fsw}
.param D=0.2941
K1 L1 L2 1
```

**観察項目：**
- 出力電圧: 約5V（入力12Vより低い＝降圧）
- ON時のエネルギー蓄積: L1に磁気エネルギー蓄積
- OFF時のエネルギー転送: L1→L2→負荷
- 1次側電流: 三角波（非連続）

**詳細**: [flyback_converter_back/README.md](flyback_converter_back/README.md)

---

#### `flyback_converter_boost/` - フライバックコンバータ（昇圧動作）

絶縁型昇降圧コンバータの昇圧動作（D > 0.5）です。

**回路パラメータ：**
- 入力電圧: V1 = 5V
- 変圧器: L1 = L2 = 0.7mH、結合係数 K = 1.0
- 出力コンデンサ: C1 = 500μF
- 負荷抵抗: R2 = 28.8Ω
- デューティ比: D = 0.7059（> 0.5）
- スイッチング周波数: fsw = 20kHz
- 理論出力電圧: Vout = D/(1-D) × Vin ≈ 12V

**ファイル：**
- `flyback_converter_boost.asc` - LTspiceシミュレーション回路図

**シミュレーション設定：**
```
.tran 500m 500m 499.83m 0.2u
.param fsw=20k
.param Tsw=1/{fsw}
.param D=0.7059
K1 L1 L2 1
```

**観察項目：**
- 出力電圧: 約12V（入力5Vより高い＝昇圧）
- ON時のエネルギー蓄積: 長時間（D=0.7059）の蓄積
- OFF時のエネルギー転送: 短時間で大きな電圧
- 1次側電流: 大きなピーク電流

**詳細**: [flyback_converter_boost/README.md](flyback_converter_boost/README.md)

---

## LTspiceの使い方

### シミュレーションの実行方法

1. LTspiceで `.asc` ファイルを開く
2. メニューから「Simulate」→「Run」を選択、またはF9キーを押す
3. 波形ビューアで測定したい素子をクリックして波形を表示

### 主な測定項目

- **電圧測定**: 素子または配線をクリック
- **電流測定**: 素子の本体部分をクリック
- **電力測定**: Altキーを押しながら素子をクリック

### パラメータの変更方法

各シミュレーションファイルには、以下のパラメータが定義されています：

```spice
.param fsw=20k      ; スイッチング周波数
.param Tsw=1/{fsw}  ; スイッチング周期
.param D=0.3        ; デューティ比
```

これらの値を変更することで、異なる条件でのシミュレーションが可能です。

### 変圧器の設定

変圧器は結合インダクタで表現されます：

```spice
K1 L1 L2 1
```

- `K1`: 結合素子名
- `L1 L2`: 結合するインダクタ
- `1`: 結合係数（1.0 = 理想結合、漏れなし）

---

## 理論値との比較

各回路の出力電圧は、以下の式で計算できます：

### フォワードコンバータ（絶縁型降圧）

```
Vout = (n2/n1) × D × Vin
```

巻数比とデューティ比で出力電圧を制御します。

### フライバックコンバータ（絶縁型昇降圧）

```
Vout = (n2/n1) × (D/(1-D)) × Vin
```

- D < 0.5: 降圧動作（Vout < Vin）
- D = 0.5: 等電圧（Vout = Vin）
- D > 0.5: 昇圧動作（Vout > Vin）

シミュレーション結果と理論値を比較し、両者が一致することを確認してください。

---

## 回路トポロジーの比較

### フォワードコンバータ vs フライバックコンバータ

| 項目 | フォワード | フライバック |
|------|----------|------------|
| **電力転送タイミング** | ON時 | OFF時 |
| **エネルギー蓄積** | 小（励磁のみ） | 大（1次インダクタ） |
| **出力電圧式** | D × Vin × (n2/n1) | (D/(1-D)) × Vin × (n2/n1) |
| **昇降圧** | 降圧のみ | 昇圧・降圧可能 |
| **部品点数** | 多（リセット巻線等） | 少 |
| **出力リプル** | 小 | 大 |
| **適用** | 大電力 | 小～中電力 |
| **連続/不連続** | 通常CCM | 通常DCM |

### 絶縁型 vs 非絶縁型

| 項目 | 絶縁型 | 非絶縁型 |
|------|-------|---------|
| **安全性** | 高（入出力絶縁） | 低 |
| **ノイズ対策** | 良好 | 普通 |
| **巻数比調整** | 可能 | 不可 |
| **極性** | 選択可能 | 固定 |
| **コスト** | 高 | 低 |
| **サイズ** | 大（変圧器） | 小 |

---

## 注意事項

1. **定常状態の確認**
   各シミュレーションは、定常状態に到達するまで十分な時間をシミュレートしています。表示範囲は定常状態の最後の数周期に絞られています。

2. **理想素子の使用**
   本シミュレーションでは、理想スイッチ、理想ダイオード、理想変圧器を使用しています。実際の回路では、以下の損失により効率が低下します：
   - スイッチングスイッチの損失（導通損失、スイッチング損失）
   - ダイオードの順方向電圧降下
   - 変圧器の銅損と鉄損
   - インダクタのDCR（直流抵抗）

3. **励磁電流のリセット**
   フォワードコンバータでは、リセット巻線が必須です。リセットしないと励磁電流が蓄積し、磁気飽和を起こします。

4. **連続/不連続モード**
   - フォワードコンバータ: 出力インダクタにより通常CCM
   - フライバックコンバータ: 通常DCM（軽負荷時）、重負荷でCCM

5. **変圧器の極性**
   ドット表記（polarity marking）に注意してください。極性を間違えると、出力電圧の極性が反転したり、回路が正しく動作しません。

---

## 学習目標

このシミュレーションを通じて、以下を理解してください：

1. **変圧器の基礎物理**
   - ファラデーの電磁誘導の法則
   - 励磁電流と負荷電流の違い
   - 1次側電流の構成: $I_1 = I_m + I_\ell$

2. **フォワードコンバータ**
   - ON時の電力転送メカニズム
   - リセット巻線の役割と必要性
   - 絶縁型降圧の動作原理

3. **フライバックコンバータ**
   - ON時のエネルギー蓄積、OFF時の転送
   - 昇降圧動作の原理（D < 0.5で降圧、D > 0.5で昇圧）
   - 非絶縁型昇降圧チョッパーとの違い

4. **絶縁の利点**
   - 安全性の向上（感電防止）
   - ノイズ対策（電気的絶縁）
   - 巻数比による電圧調整の自由度

5. **設計パラメータ**
   - デューティ比Dの影響
   - 巻数比の選択
   - スイッチング周波数の影響
   - 出力フィルタ（LC）の設計

---

## 発展的な学習課題

### 1. 効率の計算

理想素子を実際のモデル（Ron、Vfwd等）に変更し、変換効率を計算してみましょう。

### 2. 損失の分析

各素子での損失を計算し、どこで最も損失が発生するか分析してみましょう。

### 3. ソフトスイッチング

ZVS（Zero Voltage Switching）やZCS（Zero Current Switching）の概念を調べ、スイッチング損失を低減する方法を考えてみましょう。

### 4. 制御回路の設計

フィードバック制御を追加し、出力電圧を一定に保つ制御回路を設計してみましょう。

---

## 参考資料

- 講義資料「パワーエレクトロニクス 第6回 直流-直流変換（２）」
- 教科書 第3章「DC-DCコンバータ」（フォワードコンバータ、フライバックコンバータ）
- LTspiceチュートリアル: [../tutorials/](../tutorials/)

---

## 関連講義

- **第5回（Lecture5）**: 非絶縁型DC-DCコンバータ [../Lecture5/](../Lecture5/)
  - 降圧チョッパー、昇圧チョッパー、昇降圧チョッパー
- **第7回（Lecture7）**: リニアレギュレータ（予定）

---

## 更新履歴

- 2024-11-07: 初版作成
  - exitation_current_switch: スイッチング時の励磁電流
  - foward_converter: フォワードコンバータ
  - flyback_converter_back: フライバック（降圧）
  - flyback_converter_boost: フライバック（昇圧）
